<h1>Web Bluetooth example</h1>

<form>
  <p>Connect with <strong><span id="name">Palm@Hutscape</span></strong>.</p>
  <button>Connect</button>
</form>

<p>Please open the Chrome browser developer console to view logs.</p>

<script>
  // Check whether the current browser supports Web BLE
  function isWebBluetoothEnabled() {
    if (navigator.bluetooth) {
      return true;
    } else {
      console.log('Web Bluetooth API is not available.')
      console.log('Please make sure the "Experimental Web Platform features" flag is enabled.')
      return false;
    }
  }

  // Pair with BLE device based on name
  function onButtonClick() {
    let options = {
      "filters": [
        { "name": document.querySelector('#name').innerText }
      ]
    }

    console.log('Requesting Bluetooth Device...');
    console.log('with options ' + JSON.stringify(options));
    navigator.bluetooth.requestDevice(options).then(device => {
      console.log('> Name:             ' + device.name);
      console.log('> Id:               ' + device.id);
      console.log('> Connected:        ' + device.gatt.connected);
    }).catch(error => {
      console.log('Argh! ' + error);
    });
  }

  // Form activities
  document.querySelector('form').addEventListener('submit', function(event) {
    event.stopPropagation();
    event.preventDefault();

    if (isWebBluetoothEnabled()) {
      onButtonClick();
    }
  });
</script>
