<!DOCTYPE html>
<html>
<head>
<title>WebUSB</title>
</head>
<body>
<button id="connect">Connect to device</button>
<p>Open the browser console to see received messages from the MCU!</p>

<!-- serial.js
From https://github.com/webusb/arduino/blob/gh-pages/demos/serial.js
Add 'vendorId': 0x2341 and 0x2a03 in line 27 and line 28
-->
<script src="serial.js"></script>
<script>
var port
let connectButton = document.querySelector('#connect')

function connect() {
  console.log('Connecting to ' + port.device_.productName + '...')
  port.connect().then(() => {
    console.log('Connected.')
    console.log("Product ID: " + port.device_.productId.toString(16))
    console.log("Vendor ID: " + port.device_.vendorId.toString(16))
    connectButton.textContent = 'Disconnect'
    port.onReceive = data => {
      let textDecoder = new TextDecoder()
      console.log(textDecoder.decode(data))
    }
    port.onReceiveError = error => {
      console.log('Receive error: ' + error)
    }
  }, error => {
    console.log('Connection error: ' + error)
  })
}

connectButton.addEventListener('click', function() {
  if (port) {
    port.disconnect()
    connectButton.textContent = 'Connect'
    port = null
  } else {
    serial.requestPort().then(selectedPort => {
      port = selectedPort
      connect()
    }).catch(error => {
      console.log('Connection error: ' + error)
    })
  }
})
</script>
</body>
</html>
